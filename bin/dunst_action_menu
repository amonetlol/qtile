#!/usr/bin/env bash

# Icons
ICON_DND_ON="󰂛"      # DND ON
ICON_DND_OFF=""     # DND OFF
ICON_POP_ONE="󱡠"     # Pop history
ICON_CLEAR_ALL=""   # Clear history

# Read current DND state
if dunstctl is-paused | grep -q true; then
    TOGGLE="$ICON_DND_OFF"
else
    TOGGLE="$ICON_DND_ON"
fi

POP_ONE="$ICON_POP_ONE"
CLEAR_ALL="$ICON_CLEAR_ALL"

# Icons dir
ICON_DIR="$HOME/.config/dunst/assets"

# Rofi theme
ROFI_THEME="$HOME/.config/rofi/dunstActionsMenu.rasi"

# Rofi theme elements
list_col='1'
list_row='3'
win_width='120px'

# Rofi menu command
rofi_cmd() {
  rofi -theme-str "window {width: $win_width;}" \
    -theme-str "listview {columns: $list_col; lines: $list_row;}" \
    -dmenu \
    -markup-rows \
    -theme $ROFI_THEME
}

CHOICE=$(printf "%s\n%s\n%s\n" \
    "$TOGGLE" \
    "$POP_ONE" \
    "$CLEAR_ALL" \
    | rofi_cmd)

case "$CHOICE" in
  "$ICON_DND_ON")
    notify-send -h string:transient:true -t 300  "DUNST" "Do-not-disturb turned on" -i $ICON_DIR/dnd.png && sleep 0.3
    dunstctl set-paused true
    ;;
  "$ICON_DND_OFF")
    dunstctl set-paused false
    notify-send -t 1000 -h string:transient:true "DUNST" "Do-not-disturb turned off" -i $ICON_DIR/bell.png
    ;;
  "$ICON_POP_ONE")
    dunstctl history-pop
    ;;
  "$ICON_CLEAR_ALL")
    dunstctl history-clear
    notify-send -t 1000 -h string:transient:true "DUNST" "Cleared notification history" -i $ICON_DIR/bell.png
    ;;
esac
